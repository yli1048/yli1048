---
title: "Week 9 API"
author: "Yanyi Li"
date: "2024-10-29"
output:
  html_document: default
  pdf_document: default
---

### Overview

In this assignment, I will use the httr2 package to send requests through the Web API and gather the most viewed New York Times articles from the past seven days. Additionally, I will convert the results into a data frame.


```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
library(httr2)
library(tidyverse)
```

```{r}
req <- request("https://api.nytimes.com/svc/mostpopular/v2/viewed/1.json?api-key=9qmUA6L7tSCea7ArphemdmGfd0okFsy2")
resp <- req |> req_perform()
resp_json <- resp |> resp_body_json(simplifyVector = TRUE)
df <- resp_json$results
head(df)
```

To clean the data, we can only extract necessary information and modify the format.

```{r}
mostviewed <- subset(df, select = c(title, byline, abstract, published_date, type, section, subsection))
names(mostviewed)[names(mostviewed) == "byline"] <- "author"
mostviewed$author <- gsub("By", "", mostviewed$author)
mostviewed$published_date <- ymd(mostviewed$published_date)
head(mostviewed)
```

```{r}
section <- mostviewed %>% count(section)
print(section)
```

```{r}
ggplot(section, aes(x = section, y = n, fill = section)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Number of Articles in Each Section", y = "number of articles")
```

```{r}
subsection <- mostviewed %>% group_by(section) %>%
  filter(section == "U.S.") %>% count(subsection)
subsection$subsection[subsection$subsection == ""] <- "No Subsection"
print(subsection)
```

```{r}
ggplot(subsection, aes(x = subsection, y = n, fill = subsection)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Number of Articles in U.S.'s Subsection", y = "number of articles")
```

The data obtained from the API indicates that the most frequently accessed articles pertain to U.S. politics. This trend suggests that there is a significant level of interest among readers in political matters.

### Conclusion
Overall, sending requests through the WebApi was straightforward and can be easily accomplished using the httr2 package. Additionally, the information obtained can be used for analysis. In this case, it's evident that U.S. politics is a popular topic that can attract a significant number of views. One way to enhance this assignment would be to explore other packages to determine which option is easier and more effective.